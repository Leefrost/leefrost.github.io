---
uri: "docker-best-practice"
objectID: "docker-best-practice-ua"
weight: 2
title: "7 практик щоб працювати з Docker на повну"
date: 2023-03-12T00:00:00.000Z
lastmod: 2023-03-12T00:00:00.000Z
draft: false
author: "Сергій Ліщук"
authorLink: "https://codestory.me"
description: "Корисні поради для роботи з Docker"
images: []
resources:
- name: "featured-image"
  src: "featured-image.png"
tags: ["докер", "контейнеризація"]
categories: ["Розгортання"]
twemoji: false
lightgallery: true
---

Програмування - це завжди шлях еволюції. Власне еволюція сучасних рішень розробки (мов, оточення, тощо) принесла чимало нових підходів та вимог - важко уявити сучасне програмування без високорівневих фреймворків, контейнерів, хмарного обчислення чи спеціальних дата сховищ. Хочу поділитись кількома практичними порадами саме для роботи з контейнерами та контейнеризацією, зокрема щодо Docker та його контейнерів.

<!--more-->

## 7 корисних практик при роботі з Docker контейнерами

Kubernetes Engine — це чудове місце для запуску ваших робочих процесів у масштабі. Але перш ніж використовувати Kubernetes, вам потрібно контейнеризувати свої програми. Ви можете запускати більшість програм у контейнері Docker без зайвих клопотів. Однак ефективне використання цих контейнерів на практиці та оптимізація процесу збирання контейнеру — це уже зовсім інші речі. Слід звернути увагу на ряд особливостей, які зроблять ваші команди розробників і тестувальників щасливими. Ця публікація містить поради та найкращі практики, які допоможуть вам ефективно створювати контейнери.

### 1. Один контейнер - одна програма

Контейнер працює найкраще, коли в ньому працює лише одна програма. Ця програма повинна мати єдиний батьківський процес - завершення якого приведе до зупинки контейнера. Це дуже корисно. Не запускайте PHP і MySQL в одному контейнері: це важче налагоджувати, сигнали Linux не оброблятимуться належним чином, ви не можете горизонтально масштабувати контейнери PHP тощо.

### 2. Правильно обробляйте PID 1, сигнали та зомбі процеси

Kubernetes і Docker надсилають сигнали Linux вашій програмі всередині контейнера, щоб зупинити її. Вони надсилають ці сигнали процесу з ідентифікатором (PID) 1. Якщо ви хочете, щоб ваша програма зупинялася правильно і коли це необхідно, вам потрібно правильно обробляти вхідні сигнали.

### 3. Використовуйте правильно кеш збірки у Docker

Docker може кешувати рівні ваших збірок, щоб прискорити повторні збірки. Це дуже корисна функція, але вона має певні особливості поведінки, які потрібно враховувати під час написання файлів Docker. Наприклад, ви повинні додати код вашої програми якомога пізніше у Dockerfile, щоб базова збірка та залежності вашої програми кешувалися й не перебудовувалися під час кожної збірки.

Наприклад:
```docker
FROM python:3.5
COPY my_code src
RUN pip install my_requirements
```

Вам варто змінити наступні стрічки коду:
```docker
FROM python:3.5
RUN pip install my_requirements
COPY my_code src
```
У новій версії результати роботи команди pip будуть закешовані для подальших збірок.

### 4. Видаляйте непотрібні залежності

Зменшення поверхні для атак вашої хост-системи завжди є хорошою ідеєю, і це набагато легше зробити з контейнерами, ніж із традиційними системами. Видаліть усе, що програмі не потрібно зі свого контейнера. Або, ще краще, додайте лише свою програму до збірки без дистрибутива або іншої початкової збірки. Ви також повинні, якщо можливо, зробити файлову систему контейнера доступною лише для читання. Це забезпечить Вам найкращу безпеку разом з продуктивністю вашої програми

### 5. Проектуйте та створюйте наймешн можливу збірку

Хто любить завантажувати сотні мегабайт непотрібних даних? Завжди тримайте одним з найкращих показників - розмір збірки - на максимально низькому рівні. Це зменшує час завантаження, час холодного запуску та використання диска. Ви можете використати кілька стратегій, щоб досягти цього: почати з мінімальної базової збірки, використати загальні рівні між збірками та не забувайте про багатоетапну збірку у Docker.

### 6. Правильно позначайте свої збірки

Теги – це те, як користувачі вибирають, яку версію вашої збірки вони хочуть використовувати. Існує два основних способи позначення тегами: семантичне керування версіями або використання хешу фіксації Git вашої програми. Незалежно від того, який ви виберете, документуйте це та чітко визначте очікування, які мають мати користувачі зібрки. Будьте обережні: хоча користувачі очікують, що деякі теги, як-от тег "latest", будуть мігрувати з однієї збірки на іншу, а також, що інші теги будуть залишатись незмінними, навіть якщо технічно це не так. Наприклад, після того, як ви позначили певну версію своєї збірки тегом «1.2.3», ви ніколи не повинні переміщувати цей тег на інші збірки.

### 7. Уважно подумайте, чи варто використовувати публічні збірки

Використання загальнодоступних збірок може бути чудовим способом почати роботу з певним програмним забезпеченням. Однак їх використання у під час релізу чи тестування може спричинити ряд проблем, особливо в середовищі з високими обмеженнями. Можливо, вам знадобиться контролювати те, що в них знаходиться, або ви можете не залежати від зовнішнього сховища, наприклад. З іншого боку, створення власних збірок для кожної частини програмного забезпечення, яке ви використовуєте, не є тривіальним, особливо тому, що вам потрібно йти в ногу з оновленнями безпеки попереднього програмного забезпечення. Ретельно зважте плюси та мінуси кожного для конкретного випадку використання та прийміть свідоме рішення.